<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>funnel_model Â· InferenceReport.jl</title><meta name="title" content="funnel_model Â· InferenceReport.jl"/><meta property="og:title" content="funnel_model Â· InferenceReport.jl"/><meta property="twitter:title" content="funnel_model Â· InferenceReport.jl"/><meta name="description" content="Documentation for InferenceReport.jl."/><meta property="og:description" content="Documentation for InferenceReport.jl."/><meta property="twitter:description" content="Documentation for InferenceReport.jl."/><meta property="og:url" content="https://Julia-Tempering.github.io/InferenceReport.jl/generated/funnel_model/src/"/><meta property="twitter:url" content="https://Julia-Tempering.github.io/InferenceReport.jl/generated/funnel_model/src/"/><link rel="canonical" href="https://Julia-Tempering.github.io/InferenceReport.jl/generated/funnel_model/src/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">InferenceReport.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">User guide</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../toy_turing_unid_model/src/"><code>toy_turing_unid_model</code></a></li><li class="is-active"><a class="tocitem" href><code>funnel_model</code></a><ul class="internal"><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Pair-plot"><span>Pair plot</span></a></li><li><a class="tocitem" href="#Trace-plots"><span>Trace plots</span></a></li><li><a class="tocitem" href="#Moments"><span>Moments</span></a></li><li><a class="tocitem" href="#Cumulative-traces"><span>Cumulative traces</span></a></li><li><a class="tocitem" href="#Local-communication-barrier"><span>Local communication barrier</span></a></li><li><a class="tocitem" href="#GCB-estimation-progress"><span>GCB estimation progress</span></a></li><li><a class="tocitem" href="#Evidence-estimation-progress"><span>Evidence estimation progress</span></a></li><li><a class="tocitem" href="#Round-trips"><span>Round trips</span></a></li><li><a class="tocitem" href="#Pigeons-summary"><span>Pigeons summary</span></a></li><li><a class="tocitem" href="#Pigeons-inputs"><span>Pigeons inputs</span></a></li><li><a class="tocitem" href="#Reproducibility"><span>Reproducibility</span></a></li></ul></li><li><a class="tocitem" href="../../banana_model/src/"><code>banana_model</code></a></li><li><a class="tocitem" href="../../eight_schools_centered_model/src/"><code>eight_schools_centered_model</code></a></li></ul></li><li><a class="tocitem" href="../../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href><code>funnel_model</code></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href><code>funnel_model</code></a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Julia-Tempering/InferenceReport.jl/blob/main/docs/src/generated/funnel_model/src/index.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>A synthetic target introduced  in <a href="https://projecteuclid.org/journals/annals-of-statistics/volume-31/issue-3/Slice-sampling/10.1214/aos/1056562461.full">Neal, 2004</a> to benchmark algorithms on situations where the local curvature of the target density  varies from one part of the space to another. Specifically, the shape of the target  (see pair plots below) is such that when <span>$y &lt; 0$</span>, the posterior is very narrow  while for <span>$y &gt; 0$</span> it is wide. </p><p>The funnel is formally defined as follows:</p><p class="math-container">\[\begin{aligned}
y &amp;\sim \text{Normal}(0, 3) \\
x_i &amp;\sim \text{Normal}(0, \exp(y / \text{scale})) \;\text{ for }i \in \{1, \dots, d\}  \\
\end{aligned}\]</p><p>Here we use the values: </p><table><tr><th style="text-align: left">Parameter</th><th style="text-align: left">Value</th></tr><tr><td style="text-align: left">Number of &quot;<span>$x$</span>&quot; dimensions, <span>$d$</span></td><td style="text-align: left">2</td></tr><tr><td style="text-align: left">Scale factor</td><td style="text-align: left">2.0</td></tr></table><p>While the example is artificial, it is useful since it combines certain features  present in many real challenging targets (varying local curvature), while having  known moments for the difficult dimension to explore, <span>$y$</span> (since <span>$y$</span> is  marginally a normal distribution with known moments). </p><p><a href="https://github.com/Julia-Tempering/Pigeons.jl/blob/main/examples/stan/funnel.stan">Stan implementation</a></p><h2 id="Pair-plot"><a class="docs-heading-anchor" href="#Pair-plot">Pair plot</a><a id="Pair-plot-1"></a><a class="docs-heading-anchor-permalink" href="#Pair-plot" title="Permalink"></a></h2><p>Diagonal entries show estimates of the marginal  densities as well as the (0.16, 0.5, 0.84)  quantiles (dotted lines).  Off-diagonal entries show estimates of the pairwise  densities. </p><p>Movie linked below (ğŸ¿) superimposes  100 iterations  of MCMC. </p><iframe src="pair_plot.svg" style="height:500px;width:100%;"></iframe>
<a href="pair_plot.svg"> ğŸ” Full page </a> â<a href="moving_pair.mp4">ğŸ¿ Movie </a> â<a href="https://sefffal.github.io/PairPlots.jl">ğŸ”— Info </a><h2 id="Trace-plots"><a class="docs-heading-anchor" href="#Trace-plots">Trace plots</a><a id="Trace-plots-1"></a><a class="docs-heading-anchor-permalink" href="#Trace-plots" title="Permalink"></a></h2><iframe src="trace_plot.svg" style="height:500px;width:100%;"></iframe>
<a href="trace_plot.svg"> ğŸ” Full page </a>  <h2 id="Moments"><a class="docs-heading-anchor" href="#Moments">Moments</a><a id="Moments-1"></a><a class="docs-heading-anchor-permalink" href="#Moments" title="Permalink"></a></h2><table><tr><th style="text-align: right"><strong>parameters</strong></th><th style="text-align: right"><strong>mean</strong></th><th style="text-align: right"><strong>std</strong></th><th style="text-align: right"><strong>mcse</strong></th><th style="text-align: right"><strong>ess_bulk</strong></th><th style="text-align: right"><strong>ess_tail</strong></th><th style="text-align: right"><strong>rhat</strong></th><th style="text-align: right"><strong>ess_per_sec</strong></th></tr><tr><td style="text-align: right">y</td><td style="text-align: right">-0.422603</td><td style="text-align: right">2.63841</td><td style="text-align: right">0.24317</td><td style="text-align: right">111.237</td><td style="text-align: right">40.3976</td><td style="text-align: right">1.01084</td><td style="text-align: right">missing</td></tr><tr><td style="text-align: right">x.1</td><td style="text-align: right">-0.0241623</td><td style="text-align: right">2.74454</td><td style="text-align: right">0.146487</td><td style="text-align: right">486.77</td><td style="text-align: right">428.904</td><td style="text-align: right">1.00693</td><td style="text-align: right">missing</td></tr><tr><td style="text-align: right">x.2</td><td style="text-align: right">-0.141497</td><td style="text-align: right">2.81189</td><td style="text-align: right">0.129082</td><td style="text-align: right">607.553</td><td style="text-align: right">467.391</td><td style="text-align: right">1.00531</td><td style="text-align: right">missing</td></tr></table><a href="Moments.csv">ğŸ’¾ CSV</a> <h2 id="Cumulative-traces"><a class="docs-heading-anchor" href="#Cumulative-traces">Cumulative traces</a><a id="Cumulative-traces-1"></a><a class="docs-heading-anchor-permalink" href="#Cumulative-traces" title="Permalink"></a></h2><p>For each iteration <span>$i$</span>, shows the running average up to <span>$i$</span>, <span>$\frac{1}{i} \sum_{n = 1}^{i} x_n$</span>. </p><iframe src="cumulative_trace_plot.svg" style="height:500px;width:100%;"></iframe>
<a href="cumulative_trace_plot.svg"> ğŸ” Full page </a>  <h2 id="Local-communication-barrier"><a class="docs-heading-anchor" href="#Local-communication-barrier">Local communication barrier</a><a id="Local-communication-barrier-1"></a><a class="docs-heading-anchor-permalink" href="#Local-communication-barrier" title="Permalink"></a></h2><p>When the global communication barrier is large, many chains may  be required to obtain tempered restarts.</p><p>The local communication barrier can be used to visualize the cause  of a high global communication barrier. For example, if there is a  sharp peak close to a reference constructed from the prior, it may  be useful to switch to a <a href="https://pigeons.run/dev/variational/#variational-pt">variational approximation</a>.</p><iframe src="local_barrier.svg" style="height:500px;width:100%;"></iframe>
<a href="local_barrier.svg"> ğŸ” Full page </a>  â<a href="https://pigeons.run/dev/output-pt/#Local-communication-barrier">ğŸ”— Info </a><h2 id="GCB-estimation-progress"><a class="docs-heading-anchor" href="#GCB-estimation-progress">GCB estimation progress</a><a id="GCB-estimation-progress-1"></a><a class="docs-heading-anchor-permalink" href="#GCB-estimation-progress" title="Permalink"></a></h2><p>Estimate of the Global Communication Barrier (GCB)  as a function of  the adaptation round. </p><p>The global communication barrier can be used  to set the number of chains.  The theoretical framework of <a href="https://academic.oup.com/jrsssb/article/84/2/321/7056147">Syed et al., 2021</a> yields that under simplifying assumptions, it is optimal to set the number of chains  (the argument <code>n_chains</code> in <code>pigeons()</code>) to roughly 2Î›.</p><p>Last round estimate: <span>$1.48023218918939$</span></p><iframe src="global_barrier_progress.svg" style="height:500px;width:100%;"></iframe>
<a href="global_barrier_progress.svg"> ğŸ” Full page </a>  â<a href="https://pigeons.run/dev/output-pt/#Global-communication-barrier">ğŸ”— Info </a><h2 id="Evidence-estimation-progress"><a class="docs-heading-anchor" href="#Evidence-estimation-progress">Evidence estimation progress</a><a id="Evidence-estimation-progress-1"></a><a class="docs-heading-anchor-permalink" href="#Evidence-estimation-progress" title="Permalink"></a></h2><p>Estimate of the log normalization (computed using  the stepping stone estimator) as a function of  the adaptation round. </p><p>Last round estimate: <span>$0.022091653206380624$</span></p><iframe src="stepping_stone_progress.svg" style="height:500px;width:100%;"></iframe>
<a href="stepping_stone_progress.svg"> ğŸ” Full page </a>  â<a href="https://pigeons.run/dev/output-normalization/">ğŸ”— Info </a><h2 id="Round-trips"><a class="docs-heading-anchor" href="#Round-trips">Round trips</a><a id="Round-trips-1"></a><a class="docs-heading-anchor-permalink" href="#Round-trips" title="Permalink"></a></h2><p>Number of tempered restarts   as a function of  the adaptation round. </p><p>A tempered restart happens when a sample from the  reference percolates to the target. When the reference  supports iid sampling, tempered restarts can enable  large jumps in the state space.</p><iframe src="n_tempered_restarts_progress.svg" style="height:500px;width:100%;"></iframe>
<a href="n_tempered_restarts_progress.svg"> ğŸ” Full page </a>  â<a href="https://pigeons.run/dev/output-pt/#Round-trips-and-tempered-restarts">ğŸ”— Info </a><h2 id="Pigeons-summary"><a class="docs-heading-anchor" href="#Pigeons-summary">Pigeons summary</a><a id="Pigeons-summary-1"></a><a class="docs-heading-anchor-permalink" href="#Pigeons-summary" title="Permalink"></a></h2><table><tr><th style="text-align: right"><strong>round</strong></th><th style="text-align: right"><strong>n_scans</strong></th><th style="text-align: right"><strong>n_tempered_restarts</strong></th><th style="text-align: right"><strong>global_barrier</strong></th><th style="text-align: right"><strong>global_barrier_variational</strong></th><th style="text-align: right"><strong>last_round_max_time</strong></th><th style="text-align: right"><strong>last_round_max_allocation</strong></th><th style="text-align: right"><strong>stepping_stone</strong></th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">2</td><td style="text-align: right">0</td><td style="text-align: right">4.44089e-16</td><td style="text-align: right">missing</td><td style="text-align: right">0.36174</td><td style="text-align: right">2.98203e7</td><td style="text-align: right">-6.66134e-16</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">4</td><td style="text-align: right">0</td><td style="text-align: right">0.0</td><td style="text-align: right">missing</td><td style="text-align: right">0.00507296</td><td style="text-align: right">111392.0</td><td style="text-align: right">3.33067e-16</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">8</td><td style="text-align: right">0</td><td style="text-align: right">0.0</td><td style="text-align: right">missing</td><td style="text-align: right">0.0103375</td><td style="text-align: right">217792.0</td><td style="text-align: right">4.44089e-16</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">16</td><td style="text-align: right">4</td><td style="text-align: right">1.55431e-15</td><td style="text-align: right">missing</td><td style="text-align: right">0.0209885</td><td style="text-align: right">430224.0</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">32</td><td style="text-align: right">12</td><td style="text-align: right">1.55431e-15</td><td style="text-align: right">missing</td><td style="text-align: right">0.0389153</td><td style="text-align: right">711392.0</td><td style="text-align: right">-4.44089e-16</td></tr><tr><td style="text-align: right">6</td><td style="text-align: right">64</td><td style="text-align: right">8</td><td style="text-align: right">1.72307</td><td style="text-align: right">missing</td><td style="text-align: right">0.442218</td><td style="text-align: right">4.91889e7</td><td style="text-align: right">0.748665</td></tr><tr><td style="text-align: right">7</td><td style="text-align: right">128</td><td style="text-align: right">20</td><td style="text-align: right">1.36131</td><td style="text-align: right">missing</td><td style="text-align: right">0.336056</td><td style="text-align: right">5.83178e7</td><td style="text-align: right">-0.171503</td></tr><tr><td style="text-align: right">8</td><td style="text-align: right">256</td><td style="text-align: right">51</td><td style="text-align: right">1.25004</td><td style="text-align: right">missing</td><td style="text-align: right">0.749864</td><td style="text-align: right">1.20281e8</td><td style="text-align: right">-0.157463</td></tr><tr><td style="text-align: right">9</td><td style="text-align: right">512</td><td style="text-align: right">101</td><td style="text-align: right">1.15616</td><td style="text-align: right">missing</td><td style="text-align: right">1.34184</td><td style="text-align: right">2.29616e8</td><td style="text-align: right">-0.039041</td></tr><tr><td style="text-align: right">10</td><td style="text-align: right">1024</td><td style="text-align: right">167</td><td style="text-align: right">1.48023</td><td style="text-align: right">missing</td><td style="text-align: right">2.89284</td><td style="text-align: right">4.919e8</td><td style="text-align: right">0.0220917</td></tr></table><a href="Pigeons_summary.csv">ğŸ’¾ CSV</a> â<a href="https://pigeons.run/dev/output-reports/">ğŸ”— Info </a><h2 id="Pigeons-inputs"><a class="docs-heading-anchor" href="#Pigeons-inputs">Pigeons inputs</a><a id="Pigeons-inputs-1"></a><a class="docs-heading-anchor-permalink" href="#Pigeons-inputs" title="Permalink"></a></h2><table><tr><th style="text-align: right"><strong>Keys</strong></th><th style="text-align: left"><strong>Values</strong></th></tr><tr><td style="text-align: right">extended_traces</td><td style="text-align: left">false</td></tr><tr><td style="text-align: right">checked_round</td><td style="text-align: left">0</td></tr><tr><td style="text-align: right">extractor</td><td style="text-align: left">nothing</td></tr><tr><td style="text-align: right">record</td><td style="text-align: left">Function[Pigeons.traces, Pigeons.round_trip, Pigeons.log_sum_ratio, Pigeons.timing_extrema, Pigeons.allocation_extrema]</td></tr><tr><td style="text-align: right">multithreaded</td><td style="text-align: left">false</td></tr><tr><td style="text-align: right">show_report</td><td style="text-align: left">true</td></tr><tr><td style="text-align: right">n_chains</td><td style="text-align: left">10</td></tr><tr><td style="text-align: right">variational</td><td style="text-align: left">GaussianReference(Dict{Symbol, Any}(:singleton_variable =&gt; [-0.4226027185293583, -0.0241622758781201, -0.14149671851415954]), Dict{Symbol, Any}(:singleton_variable =&gt; [2.638409327831311, 2.7445397005079486, 2.8118930262085873]), 5)</td></tr><tr><td style="text-align: right">explorer</td><td style="text-align: left">nothing</td></tr><tr><td style="text-align: right">n_chains_variational</td><td style="text-align: left">0</td></tr><tr><td style="text-align: right">target</td><td style="text-align: left">StanLogPotential(funnel_model)</td></tr><tr><td style="text-align: right">n_rounds</td><td style="text-align: left">10</td></tr><tr><td style="text-align: right">exec_folder</td><td style="text-align: left">nothing</td></tr><tr><td style="text-align: right">reference</td><td style="text-align: left">nothing</td></tr><tr><td style="text-align: right">checkpoint</td><td style="text-align: left">false</td></tr><tr><td style="text-align: right">seed</td><td style="text-align: left">1</td></tr></table><a href="Pigeons_inputs.csv">ğŸ’¾ CSV</a> â<a href="https://pigeons.run/dev/reference/#Pigeons.Inputs">ğŸ”— Info </a><h2 id="Reproducibility"><a class="docs-heading-anchor" href="#Reproducibility">Reproducibility</a><a id="Reproducibility-1"></a><a class="docs-heading-anchor-permalink" href="#Reproducibility" title="Permalink"></a></h2><pre><code class="nohighlight hljs">run(`git clone https://github.com/Julia-Tempering/InferenceReport.jl`)
cd(&quot;InferenceReport.jl&quot;)
run(`git checkout 881ca9b392a4a59a37875104a8a5cf908ce155b3`)

using Pkg 
Pkg.activate(&quot;.&quot;)
Pkg.instantiate()
 

using Pigeons
inputs = Inputs(; target = Pigeons.stan_funnel(2), variational = GaussianReference(first_tuning_round = 5), n_rounds = 10, record = [traces; round_trip; record_default()])
 

pt = pigeons(inputs)
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../toy_turing_unid_model/src/">Â« <code>toy_turing_unid_model</code></a><a class="docs-footer-nextpage" href="../../banana_model/src/"><code>banana_model</code> Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 26 February 2024 23:42">Monday 26 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
